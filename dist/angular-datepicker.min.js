"use strict";!function(a){var b=a.module("datePicker",[]);b.constant("datePickerConfig",{template:"templates/datepicker.html",view:"date",views:["year","month","date","hours","minutes"],momentNames:{year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"},compareFunctions:{date:"isSameDay",year:"isSameYear",month:"isSameMonth",hours:"isSameHour",minutes:"isSameMinutes"},titleFormats:{month:"YYYY",date:"YYYY MMMM",hours:"LL",minutes:"LL"},itemFormats:{date:"DD",year:"YYYY",month:"MMM",hours:"HH:mm",minutes:"HH:mm"},step:5}),b.filter("mFormat",["datePickerUtils",function(a){return function(b,c,d){return a.formatDate(b,c,d)}}]),b.directive("datePicker",["datePickerConfig","datePickerUtils",function(b,c){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?"},link:function(d,e,f,g){function h(){d.views=b.views.concat(),d.view=f.view||b.view,d.views=d.views.slice(d.views.indexOf(f.maxView||"year"),d.views.indexOf(f.minView||"minutes")+1),(1===d.views.length||-1===d.views.indexOf(d.view))&&(d.view=d.views[0])}function i(a){return c.getDate(d,f,a)}function j(){z=d.date.clone(),g&&(g.$modelValue=d.date.toDate()),d.$emit("setDate",d.date.toDate(),d.view),d.callbackOnSetDate&&d.callbackOnSetDate(f.datePicker,d.date.toDate())}function k(){var a=d.view;c.setParams(r,A);var b=d.date;c.isValidDate(b)||(b=s());var e;switch(a){case"year":e=c.getVisibleYears(b);break;case"month":e=c.getVisibleMonths(b);break;case"date":d.weekdays=d.weekdays||c.getDaysOfWeek(),e=c.getVisibleDays(b);break;case"hours":e=c.getVisibleHours(b);break;case"minutes":e=c.getVisibleMinutes(b,u)}m(e)}function l(){return"date"!==d.view?d.view:d.date?d.date.month():null}function m(a){var e,f=d.view,g=d.date,h=b.itemFormats[f],i=b.compareFunctions[f],j=[],k=[];a||(a=d.items),c.setParams(r,A),"year"===f?d.title=a[0].year()+" - "+a[a.length-1].year():d.title=c.formatDate(g,b.titleFormats[f],r);for(var l=0;l<a.length;l++){var m=a[l],o=!0;j=[],z&&c[i](z,a[l])&&j.push("active"),q(a[l],f)&&j.push("now"),"date"===f&&a[l].month()!==g.month()&&j.push("disabled"),n(a[l])||(j.push("invalid"),o=!1),e=m.clone(),e.title=c.formatDate(m,h),e.classes=j.join(" "),e.selectable=o,k.push(e)}d.items=k}function n(a){var b=!0;return v&&v.isAfter(a)&&(b=o(v,a)),w&&w.isBefore(a)&&(b&=o(w,a)),b}function o(a,c){return a.isSame(c,b.momentNames[d.view])?!0:!1}function p(a){return v&&v.isAfter(a)?v:w&&w.isBefore(a)?w:a}function q(a,b){var c=!0;switch(b){case"minutes":c&=~~(y.minutes()/u)===~~(a.minutes()/u);case"hours":c&=y.hours()===a.hours();case"date":c&=y.date()===a.date();case"month":c&=y.month()===a.month();case"year":c&=y.year()===a.year()}return c}var r=d.tz=f.timezone,s=c.createMoment,t=c.eventIsForPicker,u=parseInt(f.step||b.step,10),v=i("minDate"),w=i("maxDate"),x=e[0].id,y=d.now=s(),z=null,A=f.firstDay&&f.firstDay>=0&&f.firstDay<=6?parseInt(f.firstDay,10):null,B=!1;A||(A=moment.localeData().firstDayOfWeek()),g?d.date=s(g.$modelValue):d.model&&(d.date=s(d.model)),d.date?z=d.date.clone():d.date=y.clone(),c.setParams(r,A),d.template=f.template||b.template,d.watchDirectChanges=void 0!==f.watchDirectChanges,d.callbackOnSetDate=f.dateChange?c.findFunction(d,f.dateChange):void 0,d.close=f.close?c.findFunction(d,f.close):void 0,h(),d.goToNow=function(){var a=s();d.date=a,k()},d.changeView=function(){var a=d.views.indexOf(d.view)-1;0>a||(d.view=d.views[a])},d.setView=function(a){-1!==d.views.indexOf(a)&&(d.view=a)},d.selectDate=function(a){if(f.disabled||!a.selectable)return!1;if(o(d.date,a)&&(a=d.date),a=p(a),!a)return!1;B=!0,d.date=a;var b=d.views[d.views.indexOf(d.view)+1];b||j(),b?d.setView(b):m()},d.$watch(l,k),d.watchDirectChanges&&d.$watch("model",function(){if(B)return void(B=!1);var a=s(d.model);z&&z.isSame(a)||(d.date=a,z=a.clone(),k())}),d.next=function(a){var b=moment(d.date);switch(a=a||("year"===d.view?10:1),d.view){case"year":case"month":b.year(b.year()+a);break;case"date":b.month(b.month()+a);break;case"hours":b.date(b.date()+a);break;case"minutes":b.hours(b.hours()+a)}b=p(b),b&&(d.date=b,k())},d.prev=function(a){return d.next(-a||("year"===d.view?-10:-1))},x&&d.$on("pickerUpdate",function(b,c,d){if(t(c,x)){var e=!1,g=!1;a.isDefined(d.minDate)&&(v=d.minDate?d.minDate:!1,g=!0),a.isDefined(d.maxDate)&&(w=d.maxDate?d.maxDate:!1,g=!0),a.isDefined(d.minView)&&(f.minView=d.minView,e=!0),a.isDefined(d.maxView)&&(f.maxView=d.maxView,e=!0),f.view=d.view||f.view,e&&h(),g&&k()}})}}}]),a.module("datePicker").factory("datePickerUtils",function(){var b,c,d=function(a,c,d,e,f){var g=Date.UTC(0|a,0|c,0|d,0|e,0|f);return b?moment.tz(g,b):moment(g)};return{getVisibleMinutes:function(a,b){var c,e,f=a.year(),g=a.month(),h=a.date(),i=a.hours(),j=a.utcOffset()/60,k=[];for(e=0;60>e;e+=b)c=d(f,g,h,i-j,e),k.push(c);return k},getVisibleDays:function(a){a=moment(a);var b=a.year(),d=a.month();a.date(1);var e=a.day();a.date(c-(e+(c>=e?6:-1)));for(var f=[],g=0;6>g&&!(100*a.year()+a.month()>100*b+d);g++)Array.prototype.push.apply(f,this.getDaysOfWeek(a)),a.add(7,"d");return f},getVisibleYears:function(a){var b=moment(a),c=b.year();b.year(c-c%10),c=b.year();for(var e,f,g=b.utcOffset()/60,h=[],i=0;12>i;i++)e=d(c,0,1,0-g),f=e.utcOffset()/60,f!==g&&(e=d(c,0,1,0-f),g=f),h.push(e),c++;return h},getDaysOfWeek:function(a){a=a?a:b?moment.tz(b).day(c):moment().day(c);for(var e,f,g=a.year(),h=a.month(),i=a.date(),j=[],k=a.utcOffset()/60,l=0;7>l;l++)e=d(g,h,i,0-k,0,!1),f=e.utcOffset()/60,f!==k&&(e=d(g,h,i,0-f,0,!1)),j.push(e),i++;return j},getVisibleMonths:function(a){for(var b,c,e=a.year(),f=a.utcOffset()/60,g=[],h=0;12>h;h++)b=d(e,h,1,0-f,0,!1),c=b.utcOffset()/60,c!==f&&(b=d(e,h,1,0-c,0,!1)),g.push(b);return g},getVisibleHours:function(a){var b,c,e,f=a.year(),g=a.month(),h=a.date(),i=[],j=a.utcOffset()/60;for(b=0;24>b;b++)c=d(f,g,h,b-j,0,!1),e=c.utcOffset()/60,e!==j&&(c=d(f,g,h,b-e,0,!1)),i.push(c);return i},isAfter:function(a,b){return a&&a.unix()>=b.unix()},isBefore:function(a,b){return a.unix()<=b.unix()},isSameYear:function(a,b){return a&&a.year()===b.year()},isSameMonth:function(a,b){return this.isSameYear(a,b)&&a.month()===b.month()},isSameDay:function(a,b){return this.isSameMonth(a,b)&&a.date()===b.date()},isSameHour:function(a,b){return this.isSameDay(a,b)&&a.hours()===b.hours()},isSameMinutes:function(a,b){return this.isSameHour(a,b)&&a.minutes()===b.minutes()},setParams:function(a,d){b=a,c=d},scopeSearch:function(a,b,c){var d,e,f=a,g=b.split("."),h=g.length;do{for(d=f=f.$parent,e=0;h>e;e++){d=d[g[e]]}if(d&&c(d))return d}while(f.$parent);return!1},findFunction:function(b,c){return this.scopeSearch(b,c,function(b){return a.isFunction(b)})},findParam:function(a,b){return this.scopeSearch(a,b,function(){return!0})},createMoment:function(a){return b?moment.tz(a,b):moment.isMoment(a)?moment.unix(a.unix()):moment(a)},getDate:function(a,b,c){var d=!1;return b[c]&&(d=this.createMoment(b[c]),d.isValid()||(d=this.findParam(a,b[c]),d&&(d=this.createMoment(d)))),d},eventIsForPicker:function(b,c){return a.isArray(b)&&b.indexOf(c)>-1||b===c},isValidDate:function(a){return a&&!(a.getTime&&a.getTime()!==a.getTime())},formatDate:function(a,b,c){return moment.isMoment(a)?c?moment.tz(a,c).format(b):a.format(b):moment(a).format(b)}}});var b=a.module("datePicker");b.directive("dateRange",["$compile","datePickerUtils","dateTimeConfig",function(b,c,d){function e(b,c,e,f,g){return d.template(a.extend(b,{ngModel:e,minDate:f&&moment.isMoment(f)?f.format():!1,maxDate:g&&moment.isMoment(g)?g.format():!1}),c)}function f(){return"picker"+Math.random().toString().substr(2)}return{scope:{start:"=",end:"="},link:function(d,g,h){function i(a){d.$broadcast("pickerUpdate",m[0],{maxDate:a})}function j(a){d.$broadcast("pickerUpdate",m[1],{minDate:a})}var k=null,l=g[0].id,m=[f(),f()],n=c.createMoment,o=c.eventIsForPicker;d.dateChange=function(a,b){k&&k(a,b)},l&&d.$on("pickerUpdate",function(a,b,c){o(b,l)&&d.$broadcast("pickerUpdate",m,c)}),c.setParams(h.timezone),d.start=n(d.start),d.end=n(d.end),d.$watchGroup(["start","end"],function(a){j(a[0]),i(a[1])}),a.isDefined(h.dateChange)&&(k=c.findFunction(d,h.dateChange)),h.onSetDate="dateChange";var p='<div><table class="date-range"><tr><td valign="top">'+e(h,m[0],"start",!1,d.end)+'</td><td valign="top">'+e(h,m[1],"end",d.start,!1)+"</td></tr></table></div>",q=b(p)(d);g.append(q)}}}]);var b=a.module("datePicker");b.constant("dateTimeConfig",{template:function(a){return'<div date-picker="'+a.ngModel+'" close="closePicker" '+(a.view?'view="'+a.view+'" ':"")+(a.maxView?'max-view="'+a.maxView+'" ':"")+(a.maxDate?'max-date="'+a.maxDate+'" ':"")+(a.template?'template="'+a.template+'" ':"")+(a.minView?'min-view="'+a.minView+'" ':"")+(a.minDate?'min-date="'+a.minDate+'" ':"")+(a.step?'step="'+a.step+'" ':"")+(a.onSetDate?'date-change="'+a.onSetDate+'" ':"")+(void 0!==a.watchDirectChanges?"watch-direct-changes ":"")+(a.firstDay?'first-day="'+a.firstDay+'" ':"")+(a.timezone?'timezone="'+a.timezone+'" ':"")+"></div>"},format:"YYYY-MM-DD HH:mm",autoClose:!0,position:"relative"}),b.directive("dateTimeAppend",function(){return{link:function(a,b){b.bind("click",function(){b.find("input")[0].focus()})}}}),b.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function(b,c,d,e,f,g){var h=c.find("body"),i=d("mFormat");return{require:"ngModel",scope:!0,link:function(c,d,j,k){function l(a){return i(a,u,E)}function m(a){var b=moment(a,u,!0);return b.isValid()?b.toDate():0===a.length?null:void 0}function n(a){A=a,j.minDate=a?a.format():a,B=moment.isMoment(a)}function o(a){C=a,j.maxDate=a?a.format():a,D=moment.isMoment(a)}function p(){t=e.template(j)}function q(a,b){a.stopPropagation(),k.$setViewValue(l(b)),k.$render()}function r(){w&&(w.remove(),w=null),z&&(z.remove(),z=null)}function s(){if(!w){if(w=b(t)(c),c.$digest(),H||(c.$on("setDate",function(a,b){q(a,b),G&&G(j.ngModel,b),v&&r()}),c.$on("$destroy",r),H=!0),"absolute"===y){var e=d[0].getBoundingClientRect(),f=e.height||d[0].offsetHeight;w.css({top:e.top+f+"px",left:e.left+"px",display:"block",position:y}),h.append(w)}else z=a.element('<div class="data-time-picker-popup top left"></div>'),d[0].parentElement.insertBefore(z[0],d[0]),z.append(w),z.css({top:d[0].offsetHeight+"px"});w.bind("mousedown",function(a){a.preventDefault()})}}var t,u=j.format||e.format,v=j.autoClose?f(j.autoClose)(c):e.autoClose,w=null,x=d[0].id,y=j.position||e.position,z=null,A=null,B=null,C=null,D=null,E=j.timezone||!1,F=g.eventIsForPicker,G=null,H=!1;c.$watch(f(j.format),function(a){a&&(u=a,k.$setViewValue(l(k.$modelValue)),k.$render())}),k.$formatters.push(l),k.$parsers.unshift(m),a.isDefined(j.minDate)&&(n(g.findParam(c,j.minDate)),k.$validators.min=function(a){return B?moment.isMoment(a)&&(A.isSame(a)||A.isBefore(a)):!0}),a.isDefined(j.maxDate)&&(o(g.findParam(c,j.maxDate)),k.$validators.max=function(a){return D?moment.isMoment(a)&&(C.isSame(a)||C.isAfter(a)):!0}),a.isDefined(j.dateChange)&&(G=g.findFunction(c,j.dateChange)),c.closePicker=r,x&&c.$on("pickerUpdate",function(b,c,d){if(F(c,x))if(w);else{var f=!1;a.isDefined(d.minDate)&&(n(d.minDate),f=!0),a.isDefined(d.maxDate)&&(o(d.maxDate),f=!0),a.isDefined(d.minView)&&(j.minView=d.minView),a.isDefined(d.maxView)&&(j.maxView=d.maxView),j.view=d.view||j.view,f&&k.$validate(),a.isDefined(d.format)&&(u=j.format=d.format||e.format,k.$modelValue=-1),p()}}),d.bind("click",s),d.bind("focus",s),d.bind("blur",r),p()}}}]),a.module("datePicker").run(["$templateCache",function(a){a.put("templates/datepicker.html",'<div class="date-time-picker">\n  <div class="header">\n    <div ng-click="prev()"><i class="icon double prev"></i></div>\n    <div ng-click="goToNow()"><i class="icon today"></i></div>\n    <div ng-click="next()"><i class="icon double next"></i></div>\n    <div class="title" ng-click="changeView()" ng-bind="title"></div>\n    <div ng-if="close" ng-click="close()"><i class="icon close"></i></div>\n  </div>\n  <div class="items weekdays" ng-if="view==\'date\'">\n    <div ng-class="{weekend: !(day.day() % 6)}" ng-repeat="day in weekdays" ng-bind="day|mFormat:\'ddd\':tz"></div>\n  </div>\n  <div class="items" ng-class="view">\n    <div ng-repeat="date in items"\n      ng-class="date.classes"\n      ng-click="selectDate(date)"\n      ng-bind="date.title">\n    </div>\n  </div>\n</div>\n\n')}])}(angular);